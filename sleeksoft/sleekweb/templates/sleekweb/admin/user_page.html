{% extends './base.html' %}
{% block content %}
<div class="flex-1 flex-col w-full h-full" style="width: calc(100% - 250px);">
    <header class="z-10 py-4 bg-white shadow-md dark:bg-gray-800 flex px-[10px] justify-center items-start md:items-center w-full">
        <button class="open_menu_website p-1 mr-5 -ml-1 rounded-md md:hidden focus:outline-none focus:shadow-outline-green"
          @click="toggleSideMenu" aria-label="Menu">
          <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
              d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
              clip-rule="evenodd"></path>
          </svg>
        </button>
        <!-- Search input -->
        <div class="flex justify-center items-center gap-2 w-full">
          <button
            class="open_form_create flex gap-2 shadow-md items-center justify-between self-start px-4 py-2 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-green-600 border border-transparent rounded-lg active:bg-green-600 hover:bg-green-700 focus:outline-none focus:shadow-outline-green">
            <svg class="fill-white w-[20px]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="feather feather-plus">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            <span class="whitespace-nowrap hidden md:block">Tạo tài khoản nhân viên mới</span>
          </button>
          <form class="flex justify-center items-center flex-col md:flex-row gap-2 grow md:grow-0">
            <div class="flex  relative items-center w-full md:w-[300px]">
              <input placeholder="Tìm kiếm tài khoản nhân viên" name="s" value="{{s}}"
                class="block pr-[30px] w-full bg-stone-100 text-sm text-stone-800 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md " />
              <button type="submit" class="absolute right-0 cursor-pointer">
                <svg class="w-[30px]" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                  <title>icon 111 search</title>
                  <desc>Created with Sketch.</desc>
                  <defs></defs>
                  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
                    <g id="icon-111-search" sketch:type="MSArtboardGroup" fill="#000000">
                      <path
                        d="M19.4271164,21.4271164 C18.0372495,22.4174803 16.3366522,23 14.5,23 C9.80557939,23 6,19.1944206 6,14.5 C6,9.80557939 9.80557939,6 14.5,6 C19.1944206,6 23,9.80557939 23,14.5 C23,16.3366522 22.4174803,18.0372495 21.4271164,19.4271164 L27.0119176,25.0119176 C27.5621186,25.5621186 27.5575313,26.4424687 27.0117185,26.9882815 L26.9882815,27.0117185 C26.4438648,27.5561352 25.5576204,27.5576204 25.0119176,27.0119176 L19.4271164,21.4271164 L19.4271164,21.4271164 Z M14.5,21 C18.0898511,21 21,18.0898511 21,14.5 C21,10.9101489 18.0898511,8 14.5,8 C10.9101489,8 8,10.9101489 8,14.5 C8,18.0898511 10.9101489,21 14.5,21 L14.5,21 Z"
                        id="search" sketch:type="MSShapeGroup"></path>
                    </g>
                  </g>
                </svg>
              </button>
            </div>
            <select name="f" onchange="this.form.submit()" value="{{f}}"
              class="bg-stone-100 text-sm text-stone-800 w-full md:w-[250px]  focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md">
              <option value="" class="bg-stone-100">--- Trạng thái tài khoản ---</option>
              <option value="1" {% if f == '1' %}selected{% endif %} class="bg-stone-100">Đã phê duyệt</option>
              <option value="0" {% if f == '0' %}selected{% endif %} class="bg-stone-100">Chưa phê duyệt</option>
            </select>
          </form>
        </div>
    </header>
    <main class="relative flex flex-col gap-2  p-[10px] overflow-y-auto bg-stone-100 grow">
        <!-- <button
            class="open_form_create flex gap-2 shadow-md items-center justify-between self-start px-4 py-2 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-green-600 border border-transparent rounded-lg active:bg-green-600 hover:bg-green-700 focus:outline-none focus:shadow-outline-green">
            <svg class="fill-white w-[20px]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            <span class="whitespace-nowrap">Tạo tài khoản nhân viên mới</span>
        </button> -->
        <h1 class="text-[18px] font-bold text-stone-800">Danh sách nhân viên</h1>
        <div class="w-full mb-8 overflow-hidden rounded-lg shadow-xs">
            <div class="content draggableDiv w-full overflow-x-auto">
                <table class="w-full whitespace-no-wrap ">
                    <thead>
                        <tr
                            class="text-xs font-semibold tracking-wide text-left text-gray-500 uppercase border-b dark:border-gray-700 bg-gray-50 dark:text-gray-400 dark:bg-gray-800">
                            {% if request.user.is_superuser %}
                            <th class="px-4 py-3 ">
                                <input type="checkbox" id="check_all_user" class="rounded-md w-[20px] h-[20px]  bg-transparent"/>
                            </th>
                            {% endif %}
                            <th class="px-4 py-3">Tài khoản</th>
                            <th class="px-4 py-3">Họ và tên</th>
                            <th class="px-4 py-3">Số điện thoại</th>
                            <th class="px-4 py-3">ĐH chờ</th>
                            <th class="px-4 py-3">Thời gian đăng ký</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y dark:divide-gray-700 dark:bg-gray-800">
                        {% for i in list_user %}
                        <tr class="text-gray-700 dark:text-gray-400">
                            {% if request.user.is_superuser %}
                            <td class="px-4 py-3 text-sm">
                                <input type="checkbox" value={{i.id}} class="check_user rounded-md w-[20px] h-[20px]  bg-transparent"/>
                            </td>
                            {% endif %}
                            <td class="px-4 py-3 text-sm">
                                {{i.email}}
                            </td>
                            <td class="px-4 py-3 text-sm">
                                {{i.Full_name|default:""}}
                            </td>
                            <td class="px-4 py-3 text-sm">
                                {{i.Phone_number|default:""}}
                            </td>
                            <td class="px-4 py-3 text-sm">
                                {{1}}
                            </td>
                            <td class="px-4 py-3 text-sm">
                                {{ i.Creation_time|date:'d-m-Y H:i:s' }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="pagination {% if list_user.paginator.num_pages <= 1 %}hidden{% endif %} border-t-[1px] border-stone-200 flex items-center justify-center" >
                <ul class="flex items-center justify-center">page</ul>
            </div>
            <button id="open_form_delete_check_list_user" style="display:none;" class="p-2 rounded-md bg-red-600 font-medium text-stone-100 mt-2">Xóa danh sách tài khoản đã chọn</button>
        </div>
        <form id="form_create_user"  style="display:none;"
            class="form_create xxx fixed z-9999 inset-0 bg-black bg-opacity-50 flex justify-center items-center px-[10px]">
            {% csrf_token %}
            <div
                class="p-4 bg-white rounded-lg shadow-md dark:bg-gray-800 w-[500px] flex flex-col gap-3 justify-center items-center">
                <h3 class="text-[18px] font-bold text-stone-800 w-full text-center">Tạo nhân viên mới</h3>
                <div class="grid grid-cols-2 gap-2 w-full">
                    <label class="block text-sm w-full {% if request.user.is_manage %}col-span-2{% endif %}">
                        <span class="font-medium text-stone-600">Họ và tên</span>
                        <input name="fl" required 
                            class="block w-full  text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md">
                    </label>
                    {% if request.user.is_superuser %}
                    <label class="block text-sm w-full ">
                        <span class="font-medium text-stone-600">Phân quyền</span>
                        <select name="is_user"
                            class="bg-white text-sm text-stone-800 w-full   focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md">
                            <option value="" class="bg-stone-100">------</option>
                            <option value="is_manage" class="bg-white text-yellow-600">Quản lý</option>
                            <option value="is_staff" class="bg-white text-green-600">Nhân viên</option>
                        </select>
                    </label>
                    {% endif %}
                    <label class="block text-sm w-full">
                        <span class="font-medium text-stone-600">Email</span>
                        <input name="em" required type="email"
                            class="block w-full  text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md">
                    </label>
                    <label class="block text-sm w-full">
                        <span class="font-medium text-stone-600">Mật khẩu</span>
                        <input name="pw" required type="password"
                            class="block w-full  text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md">
                    </label>
                    {% if request.user.is_manage %}
                    <label class="flex flex-col text-sm w-full h-[250px] col-span-2">
                        <span class="font-medium text-stone-600">Chiến dịch</span>
                        <input type="hidden" name="Belong_Campaign" id="Belong_Campaign"
                            class="block w-full  text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md "
                            >
                        <input id="Belong_Campaign_label"
                            class="block w-full  text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md "
                            readonly>
                        <div class="flex flex-col grow rounded-md overflow-hidden p-2 bg-stone-300 mt-2 gap-2 h-full col-span-2">
                            <div id="menu_list_campaign" class="flex flex-col gap-1 h-full overflow-y-auto">
                                <!-- Chiến dịch -->
                                {% for i in list_campaign %}
                                <span data-campaign-name="{{i.Name}}" data-campaign-id="{{i.id}}" class="import_campaign cursor-pointer hover:text-green-700">
                                    {{i.Name}}
                                </span>
                                {% endfor %}
                            </div>
                            <div class="flex  relative items-center w-full">
                                <input placeholder="Tìm kiếm Chiến dịch" name="s_campaign"
                                    class="block pr-[30px] w-full  text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md " />
                                <svg id="submit_search_campaign"  class="w-[30px] absolute right-0 cursor-pointer" viewBox="0 0 32 32" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                                    xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                                    <title>icon 111 search</title>
                                    <desc>Created with Sketch.</desc>
                                    <defs></defs>
                                    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"
                                        sketch:type="MSPage">
                                        <g id="icon-111-search" sketch:type="MSArtboardGroup" fill="#000000">
                                            <path
                                                d="M19.4271164,21.4271164 C18.0372495,22.4174803 16.3366522,23 14.5,23 C9.80557939,23 6,19.1944206 6,14.5 C6,9.80557939 9.80557939,6 14.5,6 C19.1944206,6 23,9.80557939 23,14.5 C23,16.3366522 22.4174803,18.0372495 21.4271164,19.4271164 L27.0119176,25.0119176 C27.5621186,25.5621186 27.5575313,26.4424687 27.0117185,26.9882815 L26.9882815,27.0117185 C26.4438648,27.5561352 25.5576204,27.5576204 25.0119176,27.0119176 L19.4271164,21.4271164 L19.4271164,21.4271164 Z M14.5,21 C18.0898511,21 21,18.0898511 21,14.5 C21,10.9101489 18.0898511,8 14.5,8 C10.9101489,8 8,10.9101489 8,14.5 C8,18.0898511 10.9101489,21 14.5,21 L14.5,21 Z"
                                                id="search" sketch:type="MSShapeGroup"></path>
                                        </g>
                                    </g>
                                </svg>
                            </div>
                        </div>
                    </label>
                    {% endif %}
                </div>
                <div class="flex items-center gap-2">
                    <button type="submit"
                        class="px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-green-600 border border-transparent rounded-md active:bg-green-600 hover:bg-green-700 focus:outline-none focus:shadow-outline-green">
                        Tạo ngay
                    </button>
                    <a
                        class=" close_form_create cursor-pointer px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-stone-600 border border-transparent rounded-md active:bg-stone-600 hover:bg-stone-700 focus:outline-none focus:shadow-outline-green">
                        Hủy
                    </a>
                </div>
            </div>
        </form>
        <form id="form_change_password"  style="display:none;"
            class="form_change_password xxx fixed z-9999 inset-0 bg-black bg-opacity-50 flex justify-center items-center px-[10px]">
            {% csrf_token %}
            <div
                class="p-4 bg-white rounded-lg shadow-md dark:bg-gray-800 w-[500px] flex flex-col gap-3 justify-center items-center">
                <h3 class="text-[18px] font-bold text-stone-800 w-full text-center">
                    Nhập mật khẩu mới cho tài khoản <span id="username_change_password" class="text-green-500"></span>
                </h3>
                <input type="hidden" name="id_user_change_password" id="id_user_change_password" />
                <label class="block text-sm w-full">
                    <input name="new_password_user" required type="password"
                        class="block w-full text-center text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md">
                </label>
                <div class="flex items-center gap-2">
                    <button type="submit"
                        class="px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-green-600 border border-transparent rounded-md active:bg-green-600 hover:bg-green-700 focus:outline-none focus:shadow-outline-green">
                        Đổi mật khẩu
                    </button>
                    <a
                        class=" close_form_change_password cursor-pointer px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-stone-600 border border-transparent rounded-md active:bg-stone-600 hover:bg-stone-700 focus:outline-none focus:shadow-outline-green">
                        Hủy
                    </a>
                </div>
            </div>
        </form>
        <form id="form_reset_user_lead"  style="display:none;"
            class="form_reset_user_lead xxx fixed z-9999 inset-0 bg-black bg-opacity-50 flex justify-center items-center px-[10px]">
            {% csrf_token %}
            <div
                class="p-4 bg-white rounded-lg shadow-md dark:bg-gray-800 w-[600px] flex flex-col gap-3 justify-center items-center">
                <h3 class="text-[16px] font-medium text-stone-800 w-full text-center">
                    <span class="text-red-500">Làm mới tài khoản sẽ xóa ra khỏi các chiến dịch và phân công CSKH</span>
                    <br>
                    Nhập <span class="text-green-500 font-medium">Tôi đồng ý</span> xuống ô bên dưới để xác nhận 
                </h3>
                <input type="hidden" name="id_reset_user_lead" id="id_reset_user_lead" />
                <label class="block text-sm w-full">
                    <input name="text_reser_user_lead" required 
                        class="block w-full text-center text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md">
                </label>
                <div class="flex items-center gap-2">
                    <button type="submit"
                        class="px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-green-600 border border-transparent rounded-md active:bg-green-600 hover:bg-green-700 focus:outline-none focus:shadow-outline-green">
                        Xác nhận
                    </button>
                    <a
                        class=" close_form_reset_user_lead cursor-pointer px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-stone-600 border border-transparent rounded-md active:bg-stone-600 hover:bg-stone-700 focus:outline-none focus:shadow-outline-green">
                        Hủy
                    </a>
                </div>
            </div>
        </form>
        <form id="form_update_campaign_user" method="post" action="{% url 'update_data_user_campaign' %}"  style="display:none;"
            class="form_update_campaign_user xxx fixed z-9999 inset-0 bg-black bg-opacity-50 flex justify-center items-center px-[10px]">
            {% csrf_token %}
            <div
                class="p-4 bg-white rounded-lg shadow-md dark:bg-gray-800 w-[600px] flex flex-col gap-3 justify-center items-center">
                <h3 class="text-[18px] font-bold text-stone-800 w-full text-center">Cập chiến dịch tài khoản
                    <span id="text_user_update_campaign" class="text-green-500 underline">th</span>
                </h3>
                <input type="hidden"  name="id_user_update_campaign"  id="id_user_update_campaign" />
                <input type="hidden"  name="list_id_user_update_campaign" id="list_id_user_update_campaign" />
                <input  type="hidden" name="list_id_user_update_campaign_delete" id="list_id_user_update_campaign_delete" />
                <table class="w-full whitespace-no-wrap border-b-[1px] border-t-[1px] border-gray-320">
                    <thead>
                        <tr
                            class="text-xs font-semibold tracking-wide text-center text-gray-500 uppercase border-b dark:border-gray-700 bg-gray-50 dark:text-gray-400 dark:bg-gray-800">
                            <th class="px-4 py-3">CD</th>
                            <th class="px-4 py-3">Thuộc CD</th>
                            <th class="px-4 py-3">Quyền xóa KH</th>
                        </tr>
                    </thead>
                    <tbody id="boddy_update_user_campaign" class="bg-white divide-y dark:divide-gray-700 dark:bg-gray-800">
                        
                    </tbody>
                </table>
                <div class="flex items-center gap-2">
                    <button type="submit"
                        class="px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-green-600 border border-transparent rounded-md active:bg-green-600 hover:bg-green-700 focus:outline-none focus:shadow-outline-green">
                        Cập nhật
                    </button>
                    <a
                        class=" close_form_update_campaign_user cursor-pointer px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-stone-600 border border-transparent rounded-md active:bg-stone-600 hover:bg-stone-700 focus:outline-none focus:shadow-outline-green">
                        Hủy
                    </a>
                </div>
            </div>
        </form>
        <form id="form_approve"  style="display:none;"
            class="form_approve xxx fixed z-9999 inset-0 bg-black bg-opacity-50 flex justify-center items-center px-[10px]">
            {% csrf_token %}
            <div
                class="p-4 bg-white rounded-lg shadow-md dark:bg-gray-800 w-[500px] flex flex-col gap-3 justify-center items-center">
                <input type="hidden" name="id_user_approve" id="id_user_approve" />
                {% if request.user.is_superuser %}
                <h3 class="text-[18px] font-bold text-stone-800 w-full text-center">
                    Chọn phân quyền cho tài khoản tài khoản <span id="username_approve" class="text-green-500"></span>
                </h3>
                <select name="is_user"
                    class="bg-white text-sm text-stone-800 w-full md:w-[250px]  focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md">
                    <option value="" class="bg-stone-100">--- Phân quyền ---</option>
                    <option value="is_manage" class="bg-white text-yellow-600">Quản lý</option>
                    <option value="is_staff" class="bg-white text-green-600">Nhân viên</option>
                </select>
                {% elif request.user.is_manage %}
                <h3 class="text-[18px] font-bold text-stone-800 w-full text-center">
                    Phê duyệt tài khoản <span id="username_approve" class="text-green-500"></span> thành nhân viên
                </h3>
                {% endif %}
                <div class="flex items-center gap-2">
                    <button type="submit"
                        class="px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-green-600 border border-transparent rounded-md active:bg-green-600 hover:bg-green-700 focus:outline-none focus:shadow-outline-green">
                        Đồng ý
                    </button>
                    <a
                        class=" close_form_approve cursor-pointer px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-stone-600 border border-transparent rounded-md active:bg-stone-600 hover:bg-stone-700 focus:outline-none focus:shadow-outline-green">
                        Hủy
                    </a>
                </div>
            </div>
        </form>
        <form id="form_delete_check_list_user" style="display:none;" class=" fixed z-9999 inset-0  flex justify-center items-center bg-black bg-opacity-50 px-[10px]">
            <div id="" class="relative xxx flex gap-3 flex-col justify-center items-center p-4 bg-white rounded-lg shadow-md text-red-500 font-medium ">
                <input type="hidden" id="check_list" />
                <span>* Danh sách tài khoản nhân viên đã chọn sẽ bị xóa *</span>
                <span class="text-stone-500">Nhập "<span class="text_code">Tôi đồng ý xóa danh sách tài khoản đã chọn</span>" vào ô bên dưới và tiến hành xóa</span>
                <input type="text"  placeholder="" id="text_check_list"  class=" w-full rounded-md text-center bg-stone-200 text-green-500" required/>
                <div></div>
                <div class="flex items-center gap-2">
                    <button type="submit"
                        class="px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-red-600 border border-transparent rounded-md active:bg-green-600 hover:bg-green-700 focus:outline-none focus:shadow-outline-green">
                        Xóa tài khoản đã chọn
                    </button>
                    <a
                        class="close_form_delete_check_list_user cursor-pointer px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-stone-600 border border-transparent rounded-md active:bg-stone-600 hover:bg-stone-700 focus:outline-none focus:shadow-outline-green">
                        Hủy
                    </a>
                </div>
            </div>
        </form>
        <form id="form_update_un_and_fl"  style="display:none;"
            class="form_update_un_and_fl xxx fixed z-9999 inset-0 bg-black bg-opacity-50 flex justify-center items-center px-[10px]">
            {% csrf_token %}
            <div
                class="p-4 bg-white rounded-lg shadow-md dark:bg-gray-800 w-[500px] flex flex-col gap-3 justify-center items-center">
                <h3 class="text-[18px] font-bold text-stone-800 w-full text-center">
                    Cập nhật thông tin tài khoản
                </h3>
                <input type="hidden" name="id_user_update" id="id_user_update" value="{{i.id}}"/>
                <div class="grid grid-cols-2 gap-2 w-full">
                    <label class="block text-sm w-full">
                        <span class="font-medium text-stone-600">Tài khoản</span>
                        <input name="un_update" id="un_update" required 
                            class="block w-full  text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md">
                    </label>
                    <label class="block text-sm w-full">
                        <span class="font-medium text-stone-600">Họ và tên</span>
                        <input name="fl_update" id="fl_update" required
                            class="block w-full  text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md">
                    </label>
                </div>
                <div class="flex items-center gap-2">
                    <button type="submit"
                        class="px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-green-600 border border-transparent rounded-md active:bg-green-600 hover:bg-green-700 focus:outline-none focus:shadow-outline-green">
                        Cập nhật
                    </button>
                    <a
                        class=" close_form_update_un_and_fl cursor-pointer px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-stone-600 border border-transparent rounded-md active:bg-stone-600 hover:bg-stone-700 focus:outline-none focus:shadow-outline-green">
                        Hủy
                    </a>
                </div>
            </div>
        </form>
    </main>
</div>
<script>
    $(document).on('click', '.import_campaign', function () {
        $("#Belong_Campaign_label").val($(this).data('campaign-name'));
        $("#Belong_Campaign").val($(this).data('campaign-id'));
    });
</script>
<script>
    $(document).ready(function () {
        // Khi nhấn nút SVG (nút tìm kiếm)
        $('#submit_search_campaign').on('click', function (event) {
            event.preventDefault();  // Ngừng hành động mặc định của nút
            // Sử dụng serialize() để lấy dữ liệu từ form
            var searchQuery_campaign = $('input[name="s_campaign"]').val();
            $.ajax({
                url: '',  // URL của API bạn muốn gọi
                method: 'POST',
                data: {
                    's': searchQuery_campaign,  // Gửi dữ liệu tìm kiếm với key là 's'
                    'csrfmiddlewaretoken': '{{ csrf_token }}'  // Đảm bảo CSRF token có trong request
                },
                success: function(response) {
                    if (response.success) {
                        $('#menu_list_campaign').empty();  // Dọn sạch danh sách trước khi thêm mới
                        for (let i = 0; i < response.list_campaign.length; i++) {
                            const campaign = response.list_campaign[i];
                            $('#menu_list_campaign').append(`
                                <span data-campaign-name="${campaign.Name}" data-campaign-id="${campaign.id}" class="import_campaign cursor-pointer hover:text-green-700">
                                    ${campaign.Name}
                                </span>
                            `);
                        }
                    } else {
                        console.log('Không tìm thấy chiến dịch nào');
                    }
                },
                error: function (response) {
                    console.log('Tìm kiếm thất bại', response);
                }
            });
        });

        $('#submit_search_user').on('click', function (event) {
            event.preventDefault();  // Ngừng hành động mặc định của nút
            // Sử dụng serialize() để lấy dữ liệu từ form
            var searchQuery_user = $('input[name="s_user"]').val();
            $.ajax({
                url: '{% url "search_user_page_admin" %}',  // URL của API bạn muốn gọi
                method: 'POST',
                data: {
                    's':searchQuery_user,  // Gửi dữ liệu tìm kiếm với key là 's'
                    'csrfmiddlewaretoken': '{{ csrf_token }}'  // Đảm bảo CSRF token có trong request
                },
                success: function(response) {
                    if (response.success) {
                        $('#menu_list_user').empty();  // Dọn sạch danh sách trước khi thêm mới
                        for (let i = 0; i < response.list_user.length; i++) {
                            const user = response.list_user[i];
                            $('#menu_list_user').append(`
                                <span data-user-name="${user.Full_name}" data-user-id="${user.id}" class="import_user cursor-pointer hover:text-green-700">
                                    ${user.Full_name}
                                </span>
                            `);
                        }
                    } else {
                        console.log('Không tìm thấy nhân viên nào');
                    }
                },
                error: function (response) {
                    console.log('Tìm kiếm thất bại', response);
                }
            });
        });
    });
</script>
<script>
    $(document).ready(function () {
        $(".open_form_create").click(function () {
            $(".xxx").hide();
            $(".form_create").show();
        });
        $(".close_form_create").click(function () {
            $(".form_create").hide();
        });

        // Định nghĩa các mảng ở phạm vi bên ngoài
let is_related_ids = [];
let is_deleted_related_ids = [];

// Hàm cập nhật giá trị vào các input hidden
function updateHiddenInputs() {
    $('#list_id_user_update_campaign').val(is_related_ids.join(','));
    $('#list_id_user_update_campaign_delete').val(is_deleted_related_ids.join(','));
}

// Hàm xử lý khi checkbox thay đổi trạng thái
function handleCheckboxChange(event, campaignId, array) {
    if (event.target.checked) {
        if (!array.includes(campaignId)) array.push(campaignId); // Thêm ID nếu chưa có
    } else {
        const index = array.indexOf(campaignId);
        if (index !== -1) array.splice(index, 1); // Xóa ID khỏi mảng
    }
    updateHiddenInputs();
}

// Xử lý sự kiện click
$(".open_form_update_campaign_user").click(function () {
    $(".xxx").hide();
    $("#text_user_update_campaign").text($(this).data('user'));
    $("#id_user_update_campaign").val($(this).data('id'));
    $(".form_update_campaign_user").show();

    // Xóa sạch dữ liệu cũ trước khi cập nhật mới
    is_related_ids = [];
    is_deleted_related_ids = [];

    var formData = new FormData();
    formData.append('id_user_update_campaign', $(this).data('id'));

    // Gọi API và xử lý kết quả
    $.ajax({
        url: '{% url "data_user_campaign" %}',
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}'
        },
        processData: false,
        contentType: false,
        data: formData,
        success: function(response) {
            if (response.success) {
                const tbody = $('#boddy_update_user_campaign');
                tbody.empty(); // Xóa các dòng cũ

                response.campaigns.forEach(campaign => {
                    const tr = $(`
                        <tr class="text-gray-700 dark:text-gray-400 text-center">
                            <td class="px-4 py-3 text-sm">
                                <span class="text-stone-800 font-medium">${campaign.name}</span>
                            </td>
                            <td class="px-4 py-3 text-sm">
                                <div class="flex justify-center items-center">
                                    <input type="checkbox" class="check_campaign rounded-md w-[20px] h-[20px] bg-transparent" 
                                        ${campaign.is_related ? 'checked' : ''} 
                                    />
                                </div>
                            </td>
                            <td class="px-4 py-3 text-sm">
                                <div class="flex justify-center items-center">
                                    <input type="checkbox" class="check_campaign_delete rounded-md w-[20px] h-[20px] bg-transparent" 
                                        ${campaign.is_deleted_related ? 'checked' : ''} 
                                    />
                                </div>
                            </td>
                        </tr>
                    `);

                    // Thêm sự kiện onchange cho checkbox
                    tr.find('.check_campaign').change(function(event) {
                        handleCheckboxChange(event, campaign.id, is_related_ids);
                    });
                    tr.find('.check_campaign_delete').change(function(event) {
                        handleCheckboxChange(event, campaign.id, is_deleted_related_ids);
                    });

                    tbody.append(tr);

                    // Thêm các ID ban đầu nếu checkbox đã được check
                    if (campaign.is_related) is_related_ids.push(campaign.id);
                    if (campaign.is_deleted_related) is_deleted_related_ids.push(campaign.id);
                });

                // Cập nhật giá trị các input hidden
                updateHiddenInputs();
            } else {
                alert(response.message);
            }
        },
        error: function(error) {
            console.error('Lỗi khi gọi API:', error);
        }
    });
});

        $(".close_form_update_campaign_user").click(function () {
            $(".form_update_campaign_user").hide();
        });


        $(".open_form_change_password").click(function () {
            $(".xxx").hide();
            $(".form_change_password").show();
            $("#username_change_password").text($(this).data('username'));
            $("#id_user_change_password").val($(this).data('id'));
        });
        $(".close_form_change_password").click(function () {
            $(".form_change_password").hide();
        });

        $(".open_form_reset_user_lead").click(function () {
            $(".xxx").hide();
            $(".form_reset_user_lead").show();
            $("#id_reset_user_lead").val($(this).data('id'));
        });
        $(".close_form_reset_user_lead").click(function () {
            $(".form_reset_user_lead").hide();
        });

        $(".open_form_approve").click(function () {
            $(".xxx").hide();
            $(".form_approve").show();
            $("#username_approve").text($(this).data('username'));
            $("#id_user_approve").val($(this).data('id'));
        });
        $(".close_form_approve").click(function () {
            $(".form_approve").hide();
        });

        $(".open_form_update_un_and_fl").click(function () {
            $(".xxx").hide();
            $(".form_update_un_and_fl").show();
            $("#un_update").val($(this).data('un'));
            $("#fl_update").val($(this).data('fl'));
            $("#id_user_update").val($(this).data('id'));
        });
        $(".close_form_update_un_and_fl").click(function () {
            $(".form_update_un_and_fl").hide();
        });
        
    });
</script>
<script>
    $(document).ready(function () {
        $(".open_form_update").click(function () {
            $(".xxx").hide();
            $(".form_update").show();
            $("#id_update").val($(this).data('id'));
            $("#name_update").val($(this).data('name'));
        });

        $(".close_form_update").click(function () {
            $(".form_update").hide();
        });
    });
</script>
<script>
    $(document).ready(function () {
        $(".open_form_delete").click(function () {
            $(".xxx").hide();
            $(".form_delete").show();
            $("#id_delete").val($(this).data('id'));
            $("#text_delete").text($(this).data('name'));
        });

        $(".close_form_delete").click(function () {
            $(".form_delete").hide();
        });
    });
</script>
<script>
    $(document).ready(function(){
        $('#open_container_form_create_user').click(function(){
            $('#container_form_create_user').show();
        });
        $('#close_container_form_create_user').click(function(){
            $('#container_form_create_user').hide();
        });

        $('#open_form_delete_check_list_user').click(function(){
            $('#form_delete_check_list_user').show();
        });
        $('.close_form_delete_check_list_user').click(function(){
            $('#form_delete_check_list_user').hide();
        });

        $('.open_container_form_recharge_user').click(function(){
            $('#container_form_recharge_user').show();
        });
        $('#close_container_form_recharge_user').click(function(){
            $('#container_form_recharge_user').hide();
        });

        $('.open_form_change_password_user').click(function(){
            $('#form_change_password_user').show();
        });
        $('#close_form_change_password_user').click(function(){
            $('#form_change_password_user').hide();
        });

               
    });
</script>
<script>
    $(document).ready(function() {
        $('#form_create_user').on('submit', function(event) {
            event.preventDefault();
        
            var formData = new FormData(this);  // Tạo FormData từ form hiện tại

            $.ajax({
                url: '{% url 'user_page_admin' %}',
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                processData: false,  // Không xử lý dữ liệu (cần thiết khi sử dụng FormData)
                contentType: false,  // Không đặt kiểu content (cần thiết khi sử dụng FormData)
                data: formData,
                success: function(response) {
                    if (response.success) {
                        window.location.href = response.redirect_url;
                    } else {
                        alert(response.message);
                    }
                },
                error: function(response) {
                    console.log('Tạo tài khoản thất bại', response);
                }
            });
        });
    });
</script>
<script>
    $(document).ready(function() {
        $('#form_update_un_and_fl').on('submit', function(event) {
            event.preventDefault();
        
            var formData = new FormData(this);  // Tạo FormData từ form hiện tại

            $.ajax({
                url: '{% url 'update_un_and_fl' %}',
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                processData: false,  // Không xử lý dữ liệu (cần thiết khi sử dụng FormData)
                contentType: false,  // Không đặt kiểu content (cần thiết khi sử dụng FormData)
                data: formData,
                success: function(response) {
                    if (response.success) {
                        window.location.href = response.redirect_url;
                    } else {
                        alert(response.message);
                    }
                },
                error: function(response) {
                    console.log('Cập nhật thất bại', response);
                }
            });
        });
    });
</script>
<script>
    $(document).ready(function() {
        $('#form_change_password').on('submit', function(event) {
            event.preventDefault();
        
            var formData = new FormData(this);  // Tạo FormData từ form hiện tại

            $.ajax({
                url: '{% url 'change_password_user_page_admin' %}',
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                processData: false,  // Không xử lý dữ liệu (cần thiết khi sử dụng FormData)
                contentType: false,  // Không đặt kiểu content (cần thiết khi sử dụng FormData)
                data: formData,
                success: function(response) {
                    if (response.success) {
                        $(".form_change_password").fadeOut(300, function() {
                            $(".form_change_password input").val('');
                            alert(response.message);
                        });
                    } else {
                        alert(response.message);
                    }
                },
                error: function(response) {
                    console.log('Đổi mật khẩu thất bại', response);
                }
            });
        });
    });
</script>
<script>
    $(document).ready(function() {
        $('#form_reset_user_lead').on('submit', function(event) {
            event.preventDefault();
        
            var formData = new FormData(this);  // Tạo FormData từ form hiện tại

            $.ajax({
                url: '{% url 'reset_user_lead_admin' %}',
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                processData: false,  // Không xử lý dữ liệu (cần thiết khi sử dụng FormData)
                contentType: false,  // Không đặt kiểu content (cần thiết khi sử dụng FormData)
                data: formData,
                success: function(response) {
                    if (response.success) {
                        window.location.href = response.redirect_url;
                    } else {
                        alert(response.message);
                    }
                },
                error: function(response) {
                    console.log('Làm mới tài khoản thất bại', response);
                }
            });
        });
    });
</script>
<script>
    $(document).ready(function() {
        $('#form_approve').on('submit', function(event) {
            event.preventDefault();
        
            var formData = new FormData(this);  // Tạo FormData từ form hiện tại

            $.ajax({
                url: '{% url 'approve_user_page_admin' %}',
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                processData: false,  // Không xử lý dữ liệu (cần thiết khi sử dụng FormData)
                contentType: false,  // Không đặt kiểu content (cần thiết khi sử dụng FormData)
                data: formData,
                success: function(response) {
                    if (response.success) {
                        window.location.href = response.redirect_url;
                    } else {
                        alert(response.message);
                    }
                },
                error: function(response) {
                    console.log('Phê duyệt thất bại', response);
                }
            });
        });
    });
</script>
<script>
    $(document).ready(function () {
        $('#form_delete_check_list_user').on('submit', function (event) {
            event.preventDefault();
            $.ajax({
                url: '{% url 'delete_check_list_user_admin' %}',
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                contentType: 'application/json',
                data: JSON.stringify({
                    check_list: $('#check_list').val(),
                    text_check_list: $('#text_check_list').val()
                }),
                success: function (response) {
                    if (response.success) {
                        window.location.href = response.redirect_url;
                    } else {
                        alert(response.message);
                    }
                },
                error: function (response) {
                    console.log('Xóa thất bại', response);
                }
            });
        });
    });
</script>
<script>
    $(document).ready(function() {
        // Bắt sự kiện khi nhấn nút "Xóa người dùng"
        $('.open_form_delete_user').on('click', function() {
            // Tìm form xóa tương ứng với nút được nhấn và hiển thị nó
            $(this).closest('th').find('.form_delete_user').removeClass('hidden');
        });
        // Bắt sự kiện khi nhấn nút "Hủy" trong form
        $('.close_form_delete_user').on('click', function() {
            // Ẩn form xóa khi nhấn "Hủy"
            $(this).closest('.form_delete_user').addClass('hidden');
            $("input").val("");
        });

        // Bắt sự kiện khi nhấn nút "Xóa người dùng"
        $('.open_form_recharge_user').on('click', function() {
            // Tìm form xóa tương ứng với nút được nhấn và hiển thị nó
            $(this).closest('th').find('.form_recharge_user').removeClass('hidden');
        });
        // Bắt sự kiện khi nhấn nút "Hủy" trong form
        $('.close_form_recharge_user').on('click', function() {
            // Ẩn form xóa khi nhấn "Hủy"
            $(this).closest('.form_recharge_user').addClass('hidden');
            $("input").val("");
        });

        // Bắt sự kiện khi nhấn nút "Xóa người dùng"
        $('.open_form_change_password_user').on('click', function() {
            // Tìm form xóa tương ứng với nút được nhấn và hiển thị nó
            $(this).closest('th').find('.form_change_password_user').removeClass('hidden');
        });
        // Bắt sự kiện khi nhấn nút "Hủy" trong form
        $('.close_form_change_password_user').on('click', function() {
            // Ẩn form xóa khi nhấn "Hủy"
            $(this).closest('.form_change_password_user').addClass('hidden');
            $("input").val("");
        });
    });    
</script>
<script>
    // JavaScript/jQuery
    $(document).ready(function() {
        // Khi checkbox 'check_all_user' thay đổi trạng thái
        $('#check_all_user').on('change', function() {
            var isChecked = $(this).is(':checked');
            
            // Cập nhật trạng thái của tất cả các checkbox 'check_user'
            $('.check_user').prop('checked', isChecked);

            // Rà soát tất cả các checkbox 'check_user' được chọn và lưu giá trị vào input hidden
            updateCheckedValues();
        });

        // Khi bất kỳ checkbox 'check_user' thay đổi trạng thái
        $('.check_user').on('change', function() {
            // Kiểm tra trạng thái của checkbox 'check_all_user'
            var allChecked = $('.check_user').length === $('.check_user:checked').length;
            $('#check_all_user').prop('checked', allChecked);

            // Rà soát tất cả các checkbox 'check_user' được chọn và lưu giá trị vào input hidden
            updateCheckedValues();
        });

        function updateCheckedValues() {
            var checkedValues = [];
            $('.check_user:checked').each(function() {
                checkedValues.push($(this).val());
            });
            $('#check_list').val(JSON.stringify(checkedValues)); // Gán mảng giá trị vào input hidden
            if (checkedValues.length > 0) {
                $('#open_form_delete_check_list_user').show();
            } else {
                $('#open_form_delete_check_list_user').hide();
            }
        }
    });
</script>
<script>
    // selecting required element
    const element = document.querySelector(".pagination ul");
    let totalPages = {{list_user.paginator.num_pages}};
    let page = {{list_user.number}};

    //calling function with passing parameters and adding inside element which is ul tag
    element.innerHTML = createPagination(totalPages, page);
    function createPagination(totalPages, page) {
        let liTag = '';
        let active;
        let beforePage = page - 1;
        let afterPage = page + 1;

        // Hiển thị nút "Trang trước" nếu không phải là trang đầu tiên
        if (page > 1) {
            liTag += `<a href="?p=${page - 1}" class="btn prev"><span><i class="fas fa-angle-left"></i>Trang trước</span></a>`;
        }

        // Nếu tổng số trang nhỏ hơn 8, hiển thị tất cả các trang mà không cần dấu ba chấm
        if (totalPages < 8) {
            for (let i = 1; i <= totalPages; i++) {
                active = (page == i) ? "active" : "";
                liTag += `<a href="?p=${i}" class="numb ${active}"><span>${i}</span></a>`;
            }
        } else {
            // Nếu tổng số trang >= 8, hiển thị có điều kiện các trang với dấu ba chấm
            if (page > 2) {
                liTag += `<a href="?p=1" class="first numb"><span>1</span></a>`;
                if (page > 3) {
                    liTag += `<a class="dots"><span>...</span></a>`;
                }
            }

            // Điều chỉnh trước và sau trang hiện tại
            if (page == totalPages) {
                beforePage = beforePage - 2;
            } else if (page == totalPages - 1) {
                beforePage = beforePage - 1;
            }
            if (page == 1) {
                afterPage = afterPage + 2;
            } else if (page == 2) {
                afterPage = afterPage + 1;
            }

            // Hiển thị các trang trong khoảng trước và sau trang hiện tại
            for (let plength = beforePage; plength <= afterPage; plength++) {
                if (plength > totalPages) continue;
                if (plength == 0) plength = 1;
                active = (page == plength) ? "active" : "";
                liTag += `<a href="?p=${plength}" class="numb ${active}"><span>${plength}</span></a>`;
            }

            // Hiển thị trang cuối cùng với dấu ba chấm nếu cần
            if (page < totalPages - 1) {
                if (page < totalPages - 2) {
                    liTag += `<a class="dots"><span>...</span></a>`;
                }
                liTag += `<a href="?p=${totalPages}" class="last numb"><span>${totalPages}</span></a>`;
            }
        }

        // Hiển thị nút "Trang sau" nếu không phải là trang cuối cùng
        if (page < totalPages) {
            liTag += `<a href="?p=${page + 1}" class="btn next"><span>Trang sau <i class="fas fa-angle-right"></i></span></a>`;
        }

        element.innerHTML = liTag;
        return liTag;
    }
</script>
<style>
    input[type="checkbox"] {
        color: #22c55e;
        --tw-ring-color: #22c55e !important; /* Dùng !important đúng cách */
        --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
        --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
    }    
    input[type='checkbox']:checked {
        background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='black' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e") !important;
    }
</style>
<style>
    option {
      background-color: black; /* Màu nền của các tùy chọn */
    }
</style>
<style>
    .loader {
        width: 80px;
        height: 80px;
        border: 13px dotted #facc15;
        border-radius: 50%;
        display: inline-block;
        position: relative;
        box-sizing: border-box;
        animation: rotation 2s linear infinite;
      }
      
      @keyframes rotation {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }  
</style>
{% endblock %}