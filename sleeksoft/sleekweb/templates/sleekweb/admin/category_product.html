{% extends './base.html' %}
{% block content %}
<div class="flex flex-col w-full h-full">
    <header class="z-10 py-4 bg-white border-b-[1px] border-stone-200 dark:bg-gray-800 flex px-[10px]  items-start md:items-center w-full">
        <button class="open_menu_website p-1 mr-5 -ml-1 rounded-md md:hidden focus:outline-none focus:shadow-outline-green"
          @click="toggleSideMenu" aria-label="Menu">
          <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
              d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
              clip-rule="evenodd"></path>
          </svg>
        </button>
        <!-- Search input -->
        <div class="flex justify-center items-start gap-2 w-full">
          <div class="flex flex-col md:flex-row justify-start h-full   gap-3 ">
            <button class="open_form_create flex gap-2 shadow-md items-center justify-between self-start px-4 py-2 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-green-600 border border-transparent rounded-lg active:bg-green-600 hover:bg-green-700 focus:outline-none focus:shadow-outline-green">
              <svg class="fill-white w-[20px]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
              <span class="whitespace-nowrap hidden md:block">Tạo Danh mục sản phẩm mới</span>
            </button>
          </div>
          <form class="flex justify-center items-center  gap-2 grow md:grow-0">
            <div class="flex  relative items-center w-full md:w-[300px]">
              <input placeholder="Tìm kiếm Danh mục sản phẩm" name="s" value="{{s}}"
                class="block pr-[30px] w-full bg-stone-100 text-sm text-stone-800 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md " />
              <button type="submit" class="absolute right-0 cursor-pointer">
                <svg class="w-[30px]" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                  <title>icon 111 search</title>
                  <desc>Created with Sketch.</desc>
                  <defs></defs>
                  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
                    <g id="icon-111-search" sketch:type="MSArtboardGroup" fill="#000000">
                      <path
                        d="M19.4271164,21.4271164 C18.0372495,22.4174803 16.3366522,23 14.5,23 C9.80557939,23 6,19.1944206 6,14.5 C6,9.80557939 9.80557939,6 14.5,6 C19.1944206,6 23,9.80557939 23,14.5 C23,16.3366522 22.4174803,18.0372495 21.4271164,19.4271164 L27.0119176,25.0119176 C27.5621186,25.5621186 27.5575313,26.4424687 27.0117185,26.9882815 L26.9882815,27.0117185 C26.4438648,27.5561352 25.5576204,27.5576204 25.0119176,27.0119176 L19.4271164,21.4271164 L19.4271164,21.4271164 Z M14.5,21 C18.0898511,21 21,18.0898511 21,14.5 C21,10.9101489 18.0898511,8 14.5,8 C10.9101489,8 8,10.9101489 8,14.5 C8,18.0898511 10.9101489,21 14.5,21 L14.5,21 Z"
                        id="search" sketch:type="MSShapeGroup"></path>
                    </g>
                  </g>
                </svg>
              </button>
            </div>
          </form>
        </div>
    </header>
    <main class="relative flex flex-col gap-2 h-full p-[10px] overflow-y-auto bg-stone-100">
    <!-- <button class="open_form_create flex gap-2 shadow-md items-center justify-between self-start px-4 py-2 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-green-600 border border-transparent rounded-lg active:bg-green-600 hover:bg-green-700 focus:outline-none focus:shadow-outline-green">
        <svg class="fill-white w-[20px]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        <span class="whitespace-nowrap">Tạo Danh mục sản phẩm mới</span>
    </button> -->
    <a href="{% url 'category_product_ad' %}" class="text-[18px] font-bold text-stone-800 hover:underline">Danh sách các Danh mục sản phẩm</a>
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
        {% for i in List_Category_product %}
        <div  class="flex flex-col gap-1 justify-center items-center rounded-lg bg-white shadow-md p-[10px]">
            <h2 data-id="{{i.id}}" data-name="{{i.Name}}" data-arrange="{{i.Arrange}}" class="open_form_update text-[16px] font-bold  hover:underline text-sky-400 cursor-pointer">
                {{i.Name}}
                <svg class="hover:text-green-600 w-[20px] fill-sky-400 inline-block align-middle"  viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                    <!-- Generator: Sketch 3.0.3 (7891) - http://www.bohemiancoding.com/sketch -->
                    <title>icon 135 pen angled</title>
                    <desc>Created with Sketch.</desc>
                    <defs></defs>
                    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
                        <g id="icon-135-pen-angled" sketch:type="MSArtboardGroup" class=" group-hover:fill-green-600 fill-sky-400">
                            <path d="M23.1464466,12.0278086 L11.8535534,23.3207019 L11.8535534,23.3207019 L7.85355339,19.3207019 L19.1464466,8.02780864 L23.1464466,12.0278086 L23.1464466,12.0278086 Z M23.8535534,11.3207018 L25.5801067,9.59414849 C26.3642921,8.8099631 26.3661881,7.54044334 25.5897496,6.76400487 L24.4102504,5.58450561 C23.6313906,4.80564584 22.372781,4.80147421 21.5801067,5.59414851 L19.8535534,7.32070186 L23.8535534,11.3207018 L23.8535534,11.3207018 Z M11.1464466,24.0278086 L11,24.1742552 L6,25.1742552 L7,20.1742552 L7.14644661,20.0278086 L11.1464466,24.0278086 L11.1464466,24.0278086 Z" id="pen-angled" sketch:type="MSShapeGroup"></path>
                        </g>
                    </g>
                </svg>
            </h2>
            <span class="font-medium text-[14px] text-stone-500">{{ i.Creation_time|date:"d-m-Y H:i" }}</span>
            <span class="font-medium text-[14px] text-stone-500">Tổng số thư mục : {{ i.category_product_detail.all.count }}</span>
            <span class="font-medium text-[14px] text-stone-500">Thứ tự xuất hiện : {{ i.Arrange }}</span>
            <div class="w-full my-1 grid grid-cols-3 text-[14px]">
                {% for j in i.category_product_detail.all %}
                <a href="{% url 'product_ad' Slug=j.Slug %}" 
                   class="text-center font-medium cursor-pointer hover:underline p-2 
                          {% if forloop.counter0|divisibleby:2 %} bg-stone-300 {% else %} bg-stone-200 {% endif %}">
                    {{ j.Name }}
                </a>
                {% endfor %}
            </div>
            {% comment %} <span  class="px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-stone-500 cursor-pointer border border-transparent rounded-md active:bg-green-600 hover:bg-stone-600 focus:outline-none focus:shadow-outline-green">
                Tạo thư mục
            </span> {% endcomment %}
            {% comment %} <div class="flex gap-3 text-sm font-bold mt-1">
                <form method="post" action="{% url 'update_Link_KH_and_So_DT_page_admin' %}" class="flex items-center gap-1">
                    {% csrf_token %}
                    <input type="hidden" name="id_update" value="{{i.id}}" />
                    <input type="checkbox" onchange="this.form.submit()" {% if i.Link_KH %}checked{% endif %} name="Link_KH" class=" rounded-md w-[20px] h-[20px] " />
                    <span>Link KH</span>
                </form>
                <form method="post" action="{% url 'update_Link_KH_and_So_DT_page_admin' %}" class="flex items-center gap-1">
                    {% csrf_token %}
                    <input type="hidden" name="id_update" value="{{i.id}}" />
                    <input type="checkbox" onchange="this.form.submit()" {% if i.So_DT %}checked{% endif %} name="So_DT" class=" rounded-md w-[20px] h-[20px] " />
                    <span>Số ĐT</span>
                </form>
            </div> {% endcomment %}
            <div class="flex items-center gap-2 mt-2">
                <a title="Xóa Danh mục">
                    <svg data-id="{{i.id}}" data-name="{{i.Name}}" class="open_form_delete fill-red-600 hover:fill-red-700 cursor-pointer w-[25px]" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 72.434 72.437" style="enable-background:new 0 0 72.434 72.437;" xml:space="preserve">
                        <path  d="M36.22,0C16.212,0,0,16.215,0,36.223c0,19.999,16.212,36.214,36.22,36.214
                            s36.214-16.215,36.214-36.214C72.434,16.215,56.228,0,36.22,0z M51.812,48.083l-4.565,4.565l-11.02-11.021L24.86,52.995
                            l-4.565-4.565l11.367-11.367L20.639,26.04l4.568-4.565l11.02,11.02l11.349-11.343l4.565,4.565L40.792,37.063L51.812,48.083z"></path>
                    </svg>
                </a>
                <a title="Thêm Thư mục" href="{% url 'category_product_child_ad' Slug=i.Slug %}">
                    <svg  class="fill-green-500 stroke-green-500 w-[30px] cursor-pointer p-0"  viewBox="0 0 64 64"  xmlns="http://www.w3.org/2000/svg">
                        <path d="M32 5.5C26.9526 5.49717 22.0095 6.93641 17.7525 9.64829C13.4955 12.3602 10.1019 16.2318 7.97119 20.8074C5.84047 25.383 5.06131 30.4721 5.72545 35.4756C6.38959 40.4791 8.46938 45.1887 11.72 49.05V49.05C11.98 49.37 12.25 49.67 12.56 50.05C12.6479 50.1357 12.7313 50.2258 12.81 50.32C12.96 50.48 13.12 50.63 13.27 50.78L13.45 50.96L13.7 51.2C14.02 51.51 14.34 51.8 14.65 52.05C14.96 52.3 15.38 52.68 15.73 52.94C16.08 53.2 16.37 53.43 16.73 53.66L17.01 53.85C17.22 54 17.44 54.15 17.62 54.26L18.23 54.64H18.29C19.04 55.09 19.76 55.48 20.49 55.84H20.6C20.92 56 21.25 56.14 21.6 56.27C22.8383 56.8 24.1154 57.2346 25.42 57.57C25.81 57.67 26.2 57.76 26.6 57.84C27 57.92 27.36 58 27.71 58.05L28.18 58.12C28.46 58.17 28.76 58.2 29.04 58.23L29.56 58.29C29.86 58.29 30.18 58.29 30.5 58.35H30.76C31.18 58.35 31.6 58.35 32.02 58.35C32.44 58.35 32.86 58.35 33.28 58.35H33.54C33.86 58.35 34.18 58.35 34.54 58.28L34.99 58.23C35.3 58.23 35.6 58.17 35.79 58.13L36.3 58.05C36.7 58.05 37.08 57.92 37.46 57.84L38.67 57.57C39.9562 57.2319 41.2162 56.8007 42.44 56.28C42.77 56.14 43.09 56 43.44 55.84L42.78 54.49L43.55 55.79C44.28 55.43 45 55.04 45.75 54.59L45.84 54.53L46.36 54.2C46.5772 54.0747 46.7875 53.9379 46.99 53.79L47.27 53.6C47.61 53.37 47.95 53.11 48.27 52.88C48.59 52.65 49.02 52.28 49.35 51.99C49.68 51.7 50.02 51.42 50.28 51.16L50.58 50.87L50.38 50.67C50.7148 50.6162 51.0214 50.4505 51.25 50.2L51.51 49.92C51.78 49.63 52.05 49.33 52.31 49.01C55.5499 45.1459 57.6196 40.4374 58.2759 35.4376C58.9322 30.4379 58.1478 25.3547 56.0149 20.7853C53.882 16.216 50.4892 12.3504 46.2351 9.64273C41.9811 6.93507 37.0426 5.49786 32 5.5V5.5ZM50 47.12V47.17C49.76 47.45 49.53 47.72 49.32 47.94L48.99 48.29C48.7965 48.5066 48.6682 48.7736 48.62 49.06L48.42 48.86L48.21 49.06C47.95 49.31 47.69 49.55 47.39 49.8C47.09 50.05 46.76 50.33 46.39 50.6C46.02 50.87 45.83 51.03 45.5 51.27L45.29 51.4C45.13 51.52 44.96 51.63 44.73 51.77L44.26 52.07H44.2C43.53 52.48 42.89 52.84 42.31 53.07C42.241 53.0946 42.1741 53.1247 42.11 53.16C41.84 53.29 41.58 53.41 41.28 53.53C40.1953 53.9919 39.0791 54.3762 37.94 54.68L36.82 55C36.49 55.07 36.17 55.14 35.82 55.19C35.7 55.19 35.58 55.24 35.36 55.26C35.14 55.28 34.92 55.32 34.67 55.35H34.24C33.97 55.35 33.7 55.4 33.42 55.41H33.1C32.3642 55.46 31.6258 55.46 30.89 55.41H30.62C30.34 55.41 30.07 55.41 29.84 55.35H29.35L28.59 55.25L28.17 55.19C27.83 55.19 27.51 55.07 27.17 55C26.83 54.93 26.44 54.84 26.11 54.76C24.9524 54.4591 23.8192 54.0713 22.72 53.6C22.45 53.49 22.18 53.37 21.94 53.25L21.79 53.18C21.1037 52.8576 20.436 52.4971 19.79 52.1H19.73L19.2 51.77C19.03 51.66 18.86 51.55 18.7 51.43L18.59 51.37C18.5436 51.3215 18.4896 51.2809 18.43 51.25C18.15 51.05 17.87 50.85 17.56 50.61C17.25 50.37 16.92 50.1 16.56 49.8C16.2 49.5 16.02 49.33 15.72 49.04L15.55 48.88L15.35 48.68L15 48.27L14.77 48C14.52 47.74 14.29 47.47 14.05 47.19V47.14C11.1739 43.7134 9.33571 39.5371 8.75134 35.1018C8.16696 30.6665 8.86072 26.1566 10.7511 22.102C12.6414 18.0474 15.6498 14.6166 19.4228 12.2128C23.1957 9.80899 27.5764 8.53206 32.05 8.53206C36.5236 8.53206 40.9043 9.80899 44.6772 12.2128C48.4501 14.6166 51.4585 18.0474 53.3489 22.102C55.2392 26.1566 55.933 30.6665 55.3486 35.1018C54.7643 39.5371 52.926 43.7134 50.05 47.14L50 47.12Z"></path>
                        <path d="M47.1798 30.5003H33.4998V16.8203C33.4998 16.4225 33.3418 16.041 33.0605 15.7597C32.7792 15.4783 32.3976 15.3203 31.9998 15.3203C31.602 15.3203 31.2205 15.4783 30.9392 15.7597C30.6579 16.041 30.4998 16.4225 30.4998 16.8203V30.5003H16.8198C16.422 30.5003 16.0405 30.6583 15.7592 30.9397C15.4779 31.221 15.3198 31.6025 15.3198 32.0003C15.3198 32.3981 15.4779 32.7797 15.7592 33.061C16.0405 33.3423 16.422 33.5003 16.8198 33.5003H30.4998V47.1803C30.4998 47.5781 30.6579 47.9597 30.9392 48.241C31.2205 48.5223 31.602 48.6803 31.9998 48.6803C32.3976 48.6803 32.7792 48.5223 33.0605 48.241C33.3418 47.9597 33.4998 47.5781 33.4998 47.1803V33.5003H47.1798C47.5776 33.5003 47.9592 33.3423 48.2405 33.061C48.5218 32.7797 48.6798 32.3981 48.6798 32.0003C48.6798 31.6025 48.5218 31.221 48.2405 30.9397C47.9592 30.6583 47.5776 30.5003 47.1798 30.5003Z" ></path>
                        </svg>
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    <form method="POST" action="{% url 'category_product_ad' %}" style="display:none;" class="form_create xxx fixed z-9999 inset-0 px-[10px] bg-black bg-opacity-50 flex justify-center items-center">
        {% csrf_token %}
        <div class="p-4 bg-white rounded-lg shadow-md dark:bg-gray-800 w-[500px] flex flex-col gap-3 justify-center items-center">
            <h3 class="text-[18px] font-bold text-stone-800 w-full text-center">Tạo Danh mục sản phẩm mới</h3>
            <label class="block text-sm w-full">
              <input name="Name" class="block w-full  text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md text-center" placeholder="Nhập tên Danh mục">
            </label>
            <div class="flex items-center gap-2">
                <button type="submit" class="px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-green-600 border border-transparent rounded-md active:bg-green-600 hover:bg-green-700 focus:outline-none focus:shadow-outline-green">
                    Tạo ngay
                </button>
                <a class=" close_form_create cursor-pointer px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-stone-600 border border-transparent rounded-md active:bg-stone-600 hover:bg-stone-700 focus:outline-none focus:shadow-outline-green">
                    Hủy
                </a>
            </div>
        </div>
    </form>
    <form method="POST" action="{% url 'update_category_product_ad' %}" style="display:none;" class="form_update xxx fixed z-9999 inset-0 px-[10px] bg-black bg-opacity-50 flex justify-center items-center">
        {% csrf_token %}
        <input type="hidden" name="id_update" id="id_update"/>
        <div class="p-4 bg-white rounded-lg shadow-md dark:bg-gray-800 w-[500px] flex flex-col gap-3 justify-center items-center">
            <h3 class="text-[18px] font-bold text-stone-800 w-full text-center">Cập nhật Danh mục sản phẩm</h3>
            <div class="grid grid-cols-2 gap-2 w-full">
                <label class="block text-sm w-full">
                    <span class="font-medium text-stone-600">Tên Danh mục</span>
                    <input name="name_update" id="name_update" class="block w-full  text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md " >
                </label>
                <label class="block text-sm w-full">
                    <span class="font-medium text-stone-600">Thứ tự xuất hiện</span>
                    <input name="name_arrange" id="name_arrange" type="number" min="0" class="block w-full  text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md " >
                </label>
            </div>
            <div class="flex items-center gap-2">
                <button type="submit" class="px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-green-600 border border-transparent rounded-md active:bg-green-600 hover:bg-green-700 focus:outline-none focus:shadow-outline-green">
                    Cập nhật
                </button>
                <a class=" close_form_update cursor-pointer px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-stone-600 border border-transparent rounded-md active:bg-stone-600 hover:bg-stone-700 focus:outline-none focus:shadow-outline-green">
                    Hủy
                </a>
            </div>
        </div>
    </form>
    <form  style="display:none;" class="form_delete xxx fixed z-9999 inset-0 bg-black bg-opacity-50 flex justify-center items-center px-[10px]">
        {% csrf_token %}
        <input type="hidden" id="id_delete" name="id_delete">
        <div class="p-4 bg-white rounded-lg shadow-md dark:bg-gray-800 w-[500px] flex flex-col gap-3 justify-center items-center">
            <h3 class="text-[16px] font-medium text-red-500 w-full text-center">
                Mọi dữ liệu liên quan đến Danh mục sản phẩm <span id="text_delete" class="text-stone-500 font-bold"></span> sẽ bị xóa.
                <br>
                <span class="text-stone-700">Nhập tên Danh mục sản phẩm sau đó tiến hành xóa ?</span>
            </h3>
            <label class="block text-sm w-full">
                <input name="text_delete_campaign" class="block w-full  text-sm dark:border-gray-600 dark:bg-gray-700 focus:border-green-400 focus:outline-none focus:shadow-outline-green dark:text-gray-300 dark:focus:shadow-outline-gray form-input rounded-md text-center" placeholder="Nhập tên Danh mục sản phẩm">
              </label>
            <div class="flex items-center gap-2">
                <button type="submit" class="px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-green-600 border border-transparent rounded-md active:bg-green-600 hover:bg-green-700 focus:outline-none focus:shadow-outline-green">
                    Tiến hành xóa
                </button>
                <a class="close_form_delete cursor-pointer px-3 py-1 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-stone-600 border border-transparent rounded-md active:bg-stone-600 hover:bg-stone-700 focus:outline-none focus:shadow-outline-green">
                    Hủy
                </a>
            </div>
        </div>
    </form>
    </main>
</div>
<script>
    $(document).ready(function() {
        $('.form_delete').on('submit', function(event) {
            event.preventDefault();
            var formData = new FormData(this);  // Tạo FormData từ form hiện tại
        
            $.ajax({
                url: '{% url 'delete_category_product_ad' %}',
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                processData: false,  // Không xử lý dữ liệu (cần thiết khi sử dụng FormData)
                contentType: false,  // Không đặt kiểu content (cần thiết khi sử dụng FormData)
                data: formData,
                success: function(response) {
                    if (response.success) {
                        window.location.href = response.redirect_url;
                    } else {
                        alert(response.message);
                    }
                },
                error: function(response) {
                    console.log('Đăng nhập thất bại', response);
                }
            });
        });
        
    });
</script>
<script>
    $(document).ready(function () {
        $(".open_form_create").click(function () {
            $(".xxx").hide();
            $(".form_create").show();
        });

        $(".close_form_create").click(function () {
            $(".form_create").hide();
        });
    });
</script>
<script>
    $(document).ready(function () {
        $(".open_form_update").click(function () {
            $(".xxx").hide();
            $(".form_update").show();
            $("#id_update").val($(this).data('id'));
            $("#name_update").val($(this).data('name'));
            $("#name_arrange").val($(this).data('arrange'));
        });

        $(".close_form_update").click(function () {
            $(".form_update").hide();
        });
    });
</script>
<script>
    $(document).ready(function () {
        $(".open_form_delete").click(function () {
            $(".xxx").hide();
            $(".form_delete").show();
            $("#id_delete").val($(this).data('id'));
            $("#text_delete").text($(this).data('name'));
        });

        $(".close_form_delete").click(function () {
            $(".form_delete").hide();
        });
    });
</script>
{% endblock %}